apiVersion: v1
kind: Service
metadata:
  name: api
spec:
  ports:
  - name: "5000"
    port: 5000    
    targetPort: 5000
  type: ExternalName
  externalName: api.com
  selector:
    io.kompose.service: api
  type: NodePort
---
apiVersion: apps/v1
kind: Deployment
metadata:
  name: api
  labels:
    app: api
spec:
  replicas: 1
  selector:
    matchLabels:
      app: api
  template:
    metadata:
      labels:
        app: api
    spec:
      containers:
      - name: api
        image: docker.io/itp22103/app-image:v1.0
        env:
        - name: FLASK_APP
          value: "run.py"
        #### Keycloak Related vars ####
        - name: KEYCLOAK_URI
          value: http://192.168.49.2:32267
        - name: ADMIN_REALM
          value: master
        - name: ADMIN_CLIENT_ID
          value: admin-cli
        - name: REALM
          value: DIT189
        - name: CLIENT_ID
          value: DIT189-Backend-Client
        - name: CLIENT_SECRET
          value: 2LculRK5Q59aQBgpWvuQj8xMsn5TeE7U
        - name: KEYCLOACK_ADMIN
          value: admin
        - name: KEYCLOACK_PASSWORD
          value: password
        #### Database Related vars ####
        - name: POSTGRES_HOST	
          value: api-db
        - name: API_DB
          value: api-db
        - name: DATABASE_USER
          value: postgres
        - name: DATABASE_PASSWORD
          value: postgres
        - name: DEV_DATABASE_URL
          value: postgresql://postgres:postgres@192.168.49.2:30022/api-db  
        ports:
        - containerPort: 5000
        # readinessProbe:
        #   httpGet:
        #     path: /ready
        #     port: 5000
        #   initialDelaySeconds: 15
        #   periodSeconds: 5
        # livenessProbe:
        #   httpGet:
        #     path: /alive
        #     port: 5000
        #   initialDelaySeconds: 20
        #   periodSeconds: 5
---
apiVersion: networking.k8s.io/v1
kind: Ingress
metadata:
  name: api
  namespace: default
spec:
  ingressClassName: nginx
  rules:
    - host: dev.k8s
      http:
        paths:
          - path: /
            pathType: ImplementationSpecific
            backend:
              service:
                name: api
                port:
                  number: 444